<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="William Fang" />
    <!--   <title>Rd2roxygen：结束R包开发者的文档噩梦 | William Fang</title>    -->
    <title>Rd2roxygen：结束R包开发者的文档噩梦 | William Fang</title> 
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <link rel="shortcut icon" href="/favicon.ico">
<!--=================================================================== 
    <link href="/media/css/bootstrap.2.2.2.min.css" >         <!--  rel="stylesheet" -
    <link href="/media/css/bootstrap.css" >
    -->
        <!-- atom & rss feed -->
    <link href="/feed/" rel="alternate" title="William Fang" type="application/atom+xml" />
     <link rel="stylesheet" href="/media/css/style.css">
    <!-- <link rel="stylesheet" href="/media/css/highlight.css">
<!--=================================================================== -->
     <!--  主题格式在 bootstrap 设置
    <link href="/media/css/bootstrap.css" rel="stylesheet">
    
    <link href="http://williamlfang.github.com/cn/media/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    -->
    <!--
    <link href="/media/css/bootstrap.2.2.2.min.css" rel="stylesheet"> 
    -->   <!-- use the timeline -->
    <!-- code hightlight -->
    <!--
    <link href="/media/google-code-prettify/prettify.css" rel="stylesheet" type="text/css" media="all">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="/media/google-code-prettify/prettify.js"></script>
     -->
     <script type="text/javascript" src="/media/js/application.js"></script>
<!-- go to top -->
    <script type="text/javascript" src="/media/js/go-top.js"></script>
<!-- outlier -->
    <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
    <!-- KICKSTART  -->
    <script src="/media/js/kickstart.js"></script>   
   <!--  <link rel="stylesheet" href="/media/css/kickstart/kickstart.css" media="all" />  
    <!-- KICKSTART -->

<script type="text/javascript" src="/media/js/outliner.js"></script>
<!--=================================================================== -->
  <script type="text/javascript">
    function setTimeSpan(){
      var date = new Date();
      timeSpan.innerText=date.format('yyyy-MM-dd hh:mm:ss');
    }
    
    Date.prototype.format = function(format)
    {
    var o =
      {
          "M+" : this.getMonth()+1, //month
          "d+" : this.getDate(),    //day
          "h+" : this.getHours(),   //hour
          "m+" : this.getMinutes(), //minute
          "s+" : this.getSeconds(), //second
          "q+" : Math.floor((this.getMonth()+3)/3),  //quarter
          "S" : this.getMilliseconds() //millisecond
      }
      if(/(y+)/.test(format))
      format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4 - RegExp.$1.length));
      for(var k in o)
      if(new RegExp("("+ k +")").test(format))
      format = format.replace(RegExp.$1,RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
      return format;
    }
  </script>
  <!--=================================================================== -->
    <script type="text/javascript">
    $(document).ready(function () {
        var bt = $('#toolBackTop');
        var sw = $(document.body)[0].clientWidth;

        var limitsw = (sw - 840) / 2 - 150;
        if (limitsw > 0){
                limitsw = parseInt(limitsw);
                bt.css("right",limitsw);
        }

        $(window).scroll(function() {
                var st = $(window).scrollTop();
                if(st > 30){
                        bt.show();
                }else{
                        bt.hide();
                }
        });
    })
    </script>
  <!--=================================================================== -->
 </head>

  <body onLoad="setInterval(setTimeSpan,1000);">
    <div id="container">
      <div id="main" role="main">
        <header>
        <h1>Rd2roxygen：结束R包开发者的文档噩梦</h1>
        </header>
        <nav id="real_nav">
        <span><a title="home page" class="" href="http://williamlfang.github.com/cn/">home</a></span>
        <span><a title="about" class="" href="http://williamlfang.github.com/cn/about/">about</a></span>
        <span><a title="publication" class="" href="http://williamlfang.github.com/cn/publication/">publication</a></span>
        <span><a title="guestbook" class="" href="http://williamlfang.github.com/cn/guestbook/">guestbook</a></span>
        <span><a title="vitae" class="" href="http://williamlfang.github.com/cn/vitae/">vitae</a></span>
        <span><a title="categories" class="" href="http://williamlfang.github.com/cn/categories/">categories</a></span>
        <span><a title="tags" class="" href="http://williamlfang.github.com/cn/tags/">tags</a></span>
	<span><a title="contact" class="" href="http://williamlfang.github.com/cn/contact/">contact</a></span>
        <span><a title="links" class="" href="http://williamlfang.github.com/cn/links/">links</a></span>
        <span><a title="subscribe by RSS" class="" href="http://williamlfang.github.com/cn/feed/">subscribe</a></span>
        </nav>
        <article class="content">
        <section class="post">
<p>本来我是计划先写统计之都改版背后的一些故事的，可是太长，还没写完，于是先发这篇短的（<a href="http://yihui.name/en/2010/12/rd2roxygen-convert-rd-to-roxygen-documentation/">刚写了英文版</a>）。说来各位客官也许不相信，但长期以来，我很不情愿更新R包，种种不情愿的事情中，以写文档为首。写两三个函数的文档还能忍受，可是写到一定数量之后就倦了，一方面原因是我的懒惰，就像我愿意用LyX而不愿意用原始LaTeX代码一样，我不喜欢写基于源代码的文档，痛恨敲<code>\title{}\author{}\description{}</code>之类的命令；另一方面，一个包中若函数写多了，相应的文档文件也多了，更新文档还得来回看，切来切去，写着很不顺手。</p>

<p>对于开发者来说，roxygen是个方便的助手，它借用了Doxygen的概念，把文档以注释的形式直接写在函数源代码之前，事后再用特别的函数处理这些特殊的注释，把它们翻译为真正的R文档。例如<code>##' @author Yihui Xie</code>就会被翻译为<code>\author{Yihui Xie}</code>。文档和源代码放在一起自然就使得写文档顺手多了，上下对着看看，就能很快明白函数是干什么的，文档该怎样写。随便<a href="https://github.com/yihui/animation/blob/master/R/BM.circle.R">抓个例子看看</a>就知道我的意思了。</p>

<p>如果只有roxygen，我还不会正式考虑用它来写文档，原因仍然会让各位客官大跌眼镜：我不喜欢重复敲这样的字符<code>##'</code>，或者我希望我敲回车到下一行的时候，编辑器能自动生成<code>##'</code>；另外我作为新手也记不住标签的名字是什么，不想每次写文档都重新敲一遍所有需要的标签。而六指琴魔的训练工具——Emacs，就出场了。</p>

<p>过去一些年头里，Emacs这个“神器”我装了卸卸了装，始终没搞明白它是怎么用的。这玩意儿就像Linux一样，没有人指导一下的话，要想玩儿转对一般人来说并不容易。也许是近一年多以来大规模用Ubuntu的原因，对命令行工作有了一定的理解，终于有一天顿悟了。那感觉就是噗嗤一团白烟腾起，你看到了一个长着翅膀的白胡子老头儿在向你招手，那就是上帝。Emacs本身并没有实质性贡献，但插件ESS可是帮了大忙，这两者结合之后，写文档变得异常轻松：写个函数，按一下<code>C-c C-o</code>，roxygen文档就生成了，填一填注释中的内容就完事；若函数添加了新参数，再按一下<code>C-c C-o</code>，新参数就被自动添加到roxygen文档注释中去了。更要命的是，它真的有换行自动填充<code>##'</code>的功能，这下我没话说了。</p>

<p>问题是我已经陷在老的R文档中了，怎么切换到roxygen的工作方式呢？前些日子在R-help发了个邮件问，结果Hadley说他有两段可参考的代码片段，我拿来一看，嚯，已经有了解析R文档的函数，尽管不完整，好几处bug，但基本框架已经有了，于是乎，克隆下来研究一番并改进了很多地方，最终放出了一个新R包，叫<a href="http://cran.r-project.org/web/packages/Rd2roxygen/index.html">Rd2roxygen</a>。给个老包的目录，<code>Rd2roxygen()</code>可以解析原文档，生成roxygen注释并插入相应的函数代码前（更新包的R文件夹下的文件）。这下才能真的投奔roxygen。</p>

<p>用同门一位同学的话说，这叫“为了懒惰而勤奋”（work hard to be lazy）。【完】</p>

<h1><del><strong>附一篇：又在掐架</strong></del></h1>

<p>现在又有两处战场。一处是个老问题，也许以前有客官听说过Rcpp的历史故事，它的第一任作者几年没更新这个包了，所以后来被Dirk和Romain接手继续开发，后来这位作者一直在纠缠署名、GPL之类的问题，今天又来了；我也不知道他想要啥。GPL协议并非对所有人都合适啊。另一处，有童鞋列举了Sweave的十大罪状，这事儿有点过了，尽管我也觉得Sweave在设计上一点都不聪明，我最不满的是它的扩展性太弱了，可能当初设计的时候并没有按照一个API的思路去写，还有很多细节问题我也颇为不满，但那娃儿写的十大罪状我都觉得不在点子上。顺带一个消息，LyX 2.0将以原生态的形式支持Sweave，目前已经有测试版，估计明年初发布正式版吧；我觉得LyX 2.0对Sweave的支持方式有点死板。</p>

</section>
<section class="meta">

<br/>
<br/>
<span>
	<a  href="http://williamlfang.github.com/cn/2010/11/07/judge-a-website-by-its-appearance/" class="pageNav"  >Previous</a>
	&nbsp;&nbsp;&nbsp;
	<a  href="http://williamlfang.github.com/cn/2010/12/06/lyx-sweave-misc-notes/" class="pageNav"  >Next</a>
</span>
<hr>
<span class="author">
  <a href="http://williamlfang.github.com">William Fang</a>
</span>
<span class="time">
  /
  <time datetime="2010-12-02">2010-12-02</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="/categories/#R language" title="R language">R language</a>&nbsp;
  
</span>


<span class="tags">
  tagged with 
  
  <a href="/tags/#Doxygen" title="Doxygen">Doxygen</a>&nbsp;
  
  <a href="/tags/#Emacs" title="Emacs">Emacs</a>&nbsp;
  
  <a href="/tags/#Emacs + ESS" title="Emacs + ESS">Emacs + ESS</a>&nbsp;
  
  <a href="/tags/#Rd2roxygen" title="Rd2roxygen">Rd2roxygen</a>&nbsp;
  
  <a href="/tags/#roxygen" title="roxygen">roxygen</a>&nbsp;
  
  <a href="/tags/#R包" title="R包">R包</a>&nbsp;
  
</span>

</section>
<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"William"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->



<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://williamlfang.github.com/cn/2010/11/07/judge-a-website-by-its-appearance/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://williamlfang.github.com/cn/2010/12/06/lyx-sweave-misc-notes/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>



        </article>
        <!--
         <a style="position:fixed;bottom:5px;right:5px;" href="#" title="Back to Top">
            <img src="/assets/images/btt.png" />
          </a>      
        -->  
        <div style="display:none;" class="back-to" id="toolBackTop">
          <a title="返回顶部" onclick="window.scrollTo(0,0);return false;" href="#top" class="back-top">返回顶部</a>
        </div>
      </div>

<footer>
  <p><small>Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> on <a href="http://pages.github.com">GitHub</a> | Copyright 2013 - 2014 by <a href="http://williamlfang.github.com">William Fang</a> | <span class="label label-info">2014-01-24 19:54:26</span></small></p>
</footer>

  </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-33748333-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

  </body>
</html>
